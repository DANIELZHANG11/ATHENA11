# yaml-language-server: $schema=https://unpkg.com/@powersync/service-schema@latest/json-schema/powersync-config.json
# 
# PowerSync Service 生产环境配置
# 参考: https://docs.powersync.com/self-hosting/installation/powersync-service-setup

# 遥测配置
telemetry:
  disable_telemetry_sharing: false

# 复制策略配置 - 连接到源 PostgreSQL 数据库
replication:
  connections:
    - type: postgresql
      # 使用环境变量配置（必须以 PS_ 开头）
      uri: !env PS_DATABASE_URL
      # 复制槽名称
      slot_name: athena_powersync
      # SSL 设置 - Docker 内部网络可以禁用
      sslmode: disable

# 存储配置 - 使用 MongoDB 作为 sync bucket 存储
# PowerSync 使用此数据库存储 sync bucket 状态和操作历史
storage:
  type: mongodb
  uri: !env PS_MONGO_URI

# API 服务器端口
port: 8080

# 同步规则
sync_rules:
  path: /config/sync-rules.yaml

# 客户端认证配置
client_auth:
  # 使用 JWKS URI 从后端获取公钥
  # 后端应提供 /api/v1/powersync/keys 端点返回 JWKS 格式的公钥
  jwks_uri: !env PS_JWKS_URL
  # JWKS audience
  audience: ["powersync", "athena"]
