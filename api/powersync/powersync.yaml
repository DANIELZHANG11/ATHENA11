# PowerSync Service 配置
# 
# 此文件配置 PowerSync Service 的连接和认证。
# 参考: https://docs.powersync.com/usage/self-hosting/configuration

# 复制策略配置
replication:
  # 连接到 PostgreSQL
  connections:
    - type: postgresql
      # 使用环境变量或直接配置
      uri: ${POWERSYNC_DATABASE_URL:-postgresql://athena:athena_secret@postgres:5432/athena}
      # 发布名称（需要在 PostgreSQL 中创建）
      publication: athena_publication
      # 复制槽名称
      slot_name: athena_powersync

# 客户端认证配置
client_auth:
  # JWT 认证
  jwks:
    # 使用与 API 相同的密钥
    keys:
      - kty: oct
        k: ${POWERSYNC_JWT_SECRET:-your-super-secret-key-change-in-production}
        alg: HS256
        use: sig

  # 认证端点 (可选，用于验证 Token)
  # supabase_auth:
  #   url: http://api:8000/api/v1/powersync/auth

# 同步规则
sync_rules:
  path: /config/sync-rules.yaml

# API 配置
api:
  # 监听地址
  listen: 0.0.0.0:8080
  
  # 是否允许客户端写入
  upload_enabled: ${POWERSYNC_UPLOAD_ENABLED:-true}
  
  # CORS 配置
  cors:
    enabled: true
    origins:
      - http://localhost:48173
      - http://localhost:5173
      - ${CORS_ORIGINS:-*}

# 指标导出
metrics:
  enabled: true
  listen: 0.0.0.0:9091

# 日志配置
log:
  level: ${POWERSYNC_LOG_LEVEL:-info}
  format: json
